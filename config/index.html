<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>配置详解 | a8k</title>
    <meta name="description" content="集成 webpack + react 的最佳实践配置的构建工具">
    
    
    <link rel="preload" href="/a8k/assets/css/0.styles.18da7d14.css" as="style"><link rel="preload" href="/a8k/assets/js/app.bccc396d.js" as="script"><link rel="preload" href="/a8k/assets/js/4.50ca767e.js" as="script"><link rel="prefetch" href="/a8k/assets/js/2.d8f505d4.js"><link rel="prefetch" href="/a8k/assets/js/3.d6afccfc.js"><link rel="prefetch" href="/a8k/assets/js/5.1ca355e5.js"><link rel="prefetch" href="/a8k/assets/js/6.7bd9203f.js"><link rel="prefetch" href="/a8k/assets/js/7.d71211a0.js">
    <link rel="stylesheet" href="/a8k/assets/css/0.styles.18da7d14.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/a8k/" class="home-link router-link-active"><!----> <span class="site-name">a8k</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/a8k/guide/" class="nav-link">简介</a></div><div class="nav-item"><a href="/a8k/config/" class="nav-link router-link-exact-active router-link-active">配置</a></div><div class="nav-item"><a href="/a8k/dev/" class="nav-link">开发指南</a></div><div class="nav-item"><a href="https://github.com/hxfdarling/a8k" target="_blank" rel="noopener noreferrer" class="nav-link external">
  在 GitHub 上编辑此页
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/a8k/guide/" class="nav-link">简介</a></div><div class="nav-item"><a href="/a8k/config/" class="nav-link router-link-exact-active router-link-active">配置</a></div><div class="nav-item"><a href="/a8k/dev/" class="nav-link">开发指南</a></div><div class="nav-item"><a href="https://github.com/hxfdarling/a8k" target="_blank" rel="noopener noreferrer" class="nav-link external">
  在 GitHub 上编辑此页
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <!----> </div> <div class="page"> <div class="content"><h1 id="配置详解"><a href="#配置详解" aria-hidden="true" class="header-anchor">#</a> 配置详解</h1> <p>a8k 封装了大多数 webpack 的配置，将常用的优化配置集成，并且针对 react 技术栈项目做了正对性配置，虽然屏蔽的大多数复杂性，但是为了对不同项目提供一些灵活的配置，a8k 也提供了一些简答且必要的配置项。</p> <blockquote><p>基于 a8k 的项目，在根目录下会有一个 a8k.config.js 的配置文件，用于项目的自定义配置</p></blockquote> <h2 id="基本配置项"><a href="#基本配置项" aria-hidden="true" class="header-anchor">#</a> 基本配置项</h2> <h3 id="mode"><a href="#mode" aria-hidden="true" class="header-anchor">#</a> mode</h3> <p>mode 用于指定项目是多页面还是单页面，支持两个值：</p> <table><thead><tr><th>值</th> <th>描述</th></tr></thead> <tbody><tr><td>single</td> <td>单页面应用，默认继承 react-router 支持路由，切构建的页面都通过动态导入的方式加载页面 js</td></tr> <tr><td>multi</td> <td>多页面应用，每个页面都有自己的入口文件，a8k 会自动抽离公共的代码，在不同的页面间共享</td></tr></tbody></table> <h3 id="dist"><a href="#dist" aria-hidden="true" class="header-anchor">#</a> dist</h3> <p>配置构建生产包（即执行<code>k build</code>）的结果输出目录，默认值:<code>dist</code>即当前项目目录下面的 dist 文件夹下</p> <h3 id="publicpath"><a href="#publicpath" aria-hidden="true" class="header-anchor">#</a> publicPath</h3> <p>和 webpack 的 output.publicPath 意义一致，指定在浏览器中所引用的「此输出目录对应的公开 URL」。相对 URL(relative URL) 会被相对于 HTML 页面（或 </p><base> 标签）解析。相对于服务的 URL(Server-relative URL)，相对于协议的 URL(protocol-relative URL) 或绝对 URL(absolute URL) 也可是可能用到的，或者有时必须用到，<p></p> <p>例如：当将资源托管到 CDN 时</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  publicPath<span class="token punctuation">:</span> <span class="token string">'https://cdn.example.com/assets/'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="cache"><a href="#cache" aria-hidden="true" class="header-anchor">#</a> cache</h3> <p>配置构建阶段的缓存目录，默认:<code>node_modules/.cache</code>。</p> <p>a8k 默认会缓存构建中 js、css、html、eslint 的结果，只有当这些文件发生变化时才会重新构建，否则其中所有的 webpack loader 都将从缓存中获取结果，目的是为了提高构建性能</p> <h3 id="babel"><a href="#babel" aria-hidden="true" class="header-anchor">#</a> babel</h3> <p>用于指定 babel 需要处理的额外文件或者需要忽略的文件，这在你调试某些库（需要被编译的代码）时非常用，支持两个配置：</p> <p><code>include</code>：需要处理的文件</p> <p><code>exclude</code>：不需要处理的文件</p> <p>include、exclude 的处理规则和 webpack rule conditions 的规则一致，详情见<a href="https://webpack.js.org/configuration/module/#rule-conditions" target="_blank" rel="noopener noreferrer">webpack rules<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>使用方法：</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  babel<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    include<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token regex">/node_modules\/lodash/</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//编译lodash</span>
    exclude<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token regex">/.*\.min\.js/</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//不处理压缩文件</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">//...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>当然你可以直接在项目目录下面使用 babel 官方配置文件，自定义 babel 配置</p></blockquote> <h3 id="crossorigin"><a href="#crossorigin" aria-hidden="true" class="header-anchor">#</a> crossOrigin</h3> <p>配置通过 script、link 引用的 js、css 资源是否支持跨域。默认<code>false</code>,支持两个值：<code>true</code>、<code>false</code></p> <p>配置为<code>true</code>会在所有的 script 标签上加上<code>crossorigin=&quot;anonymous&quot;</code>,这对于那些将静态资源部署到 CDN 上的应用非常有用，可以让错误捕获程序捕获到来自 CDN 的 js 错误堆栈。如果资源跨域了，但是没配置这个，当出现未捕获的错误时你只会得到<code>Script Error</code>错误，这对于处理现网问题非常不利。</p> <h3 id="devserver"><a href="#devserver" aria-hidden="true" class="header-anchor">#</a> devServer</h3> <p>该顶配置项用于指定开发服务器信息，用于修改 <code>webpack-dev-server</code>插件的配置，通常你只需要修改端口信息即可。具体支持的配置项<a href="https://webpack.js.org/configuration/dev-server/" target="_blank" rel="noopener noreferrer">见文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="高级配置项"><a href="#高级配置项" aria-hidden="true" class="header-anchor">#</a> 高级配置项</h2> <h3 id="retry"><a href="#retry" aria-hidden="true" class="header-anchor">#</a> retry</h3> <p>JavaScript、css 加载多域名重试配置,配置项支持：<code>retryPublicPath</code>,<code>exclude</code></p> <p>配置示例:</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  retry<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    retry<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      retryPublicPath<span class="token punctuation">:</span> <span class="token string">'//fudao.qq.com/pc/'</span><span class="token punctuation">,</span> <span class="token comment">//重试的地址前缀</span>
      exclude<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token regex">/\/\/sqimg\.qq\.com/</span><span class="token punctuation">,</span> <span class="token regex">/pub\.idqqimg\.com/</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 通过正则表达式，排除不需要重试的文件</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="ssrconfig"><a href="#ssrconfig" aria-hidden="true" class="header-anchor">#</a> ssrConfig</h3> <p>服务器渲染配置</p> <p><code>dist</code>:服务器渲染代码入口构建存放目录，默认值：<code>./app/components</code></p> <p><code>view</code>:视图代码存放目录（及 html 模板存放目录),默认值:<code>./app/views</code></p> <p><code>entry</code>:支持服务器渲染的页面入口文件</p> <p>配置示例：</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//省略其他配置</span>
  ssrConfig<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    dist<span class="token punctuation">:</span> <span class="token string">'./app/components/'</span><span class="token punctuation">,</span>
    view<span class="token punctuation">:</span> <span class="token string">'./app/views'</span><span class="token punctuation">,</span>
    entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      providerDiscover<span class="token punctuation">:</span> <span class="token string">'./src/pages/discover/ProviderDiscover'</span><span class="token punctuation">,</span>
      providerCourse<span class="token punctuation">:</span> <span class="token string">'./src/pages/course/ProviderCourse'</span><span class="token punctuation">,</span>
      providerSearch<span class="token punctuation">:</span> <span class="token string">'./src/pages/search/ProviderSearch'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="ignorepages"><a href="#ignorepages" aria-hidden="true" class="header-anchor">#</a> ignorePages</h3> <p>正则表达式，配置<code>src/pages</code>目录下面需要排除的文件夹，使用场景是你希望构建不要处理 <code>src/pages</code> 目录下面的某些目录（及排除这些目录作为页面处理)</p> <h2 id="自定义-webpack-配置"><a href="#自定义-webpack-配置" aria-hidden="true" class="header-anchor">#</a> 自定义 webpack 配置</h2> <p>利用了 webpack-chain 实现自定义配置，具体配置项是<code>chainWebpack</code>,该配置项提供一个函数，参数有<code>config、options</code></p> <p><code>config</code>: 是 WebpackChain 实例对象；</p> <p><code>options</code>: 中包括了两个重要参数：<code>type</code>和<code>mode</code>,其中 type 取值<code>server</code>或<code>client</code>分别标识服务器代码、前端代码,mode 取值<code>production</code>或<code>development</code>,标识是生产模式还是开发模式</p> <p>配置示例:</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//省略其他配置</span>
  <span class="token comment">/**
   * @param WebpackChain config webpackChain实例对象
   * @param {type:string,mode:string} options 包括:type取值:server、client;mode取值:production、development
   */</span>
  <span class="token function">chainWebpack</span><span class="token punctuation">(</span><span class="token parameter">config<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//添加自定义loader</span>
    config<span class="token punctuation">.</span>module
      <span class="token punctuation">.</span><span class="token function">rule</span><span class="token punctuation">(</span><span class="token string">'css'</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token regex">/\.(scss|css)$/</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">'loader-name'</span><span class="token punctuation">)</span> <span class="token comment">//配置一个名字，方便标识</span>
      <span class="token punctuation">.</span><span class="token function">loader</span><span class="token punctuation">(</span><span class="token string">'style-loader'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//自定义plugin</span>
    <span class="token keyword">const</span> Plugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'you-plugin-module'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Plugin<span class="token punctuation">.</span>__expression <span class="token operator">=</span> <span class="token template-string"><span class="token string">`require('you-plugin-module')`</span></span><span class="token punctuation">;</span>
    config<span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string">'you-plugin-name'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Plugin<span class="token punctuation">,</span> <span class="token punctuation">[</span>params1<span class="token punctuation">,</span> params2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>更多配置方法请参考哦<a href="https://github.com/neutrinojs/webpack-chain" target="_blank" rel="noopener noreferrer">webpack chain 文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">5/27/2019, 11:44:09 AM</span></div></div> <!----> </div> <!----></div></div>
    <script src="/a8k/assets/js/app.bccc396d.js" defer></script><script src="/a8k/assets/js/4.50ca767e.js" defer></script>
  </body>
</html>
